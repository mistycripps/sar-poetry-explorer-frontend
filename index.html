<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SAR Poetry Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#FFFFFF;
      --panel:#ffffff;
      --panel-2:#f5f5f5;
      --text:#111827;
      --muted:#6b7280;
      --border:rgba(17,24,39,.12);
      --accent:#590202;
      --accent-2:#7b0a0a;
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.25);
     
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:24px;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    /* App shell */
    .app{
      width:100%;
      max-width:var(--max);
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.2);
      border-radius:28px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(16px);
      overflow:hidden;
    }

    /* Header */
    .header{
      padding:16px 18px;
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
      border-bottom:1px solid rgba(255,255,255,.25);
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      color:#fff;
    }
    .title h1{
      margin:0;
      font-size:15px;
      letter-spacing:.02em;
      font-weight:650;
    }
    .title span{
      font-size:11px;
      letter-spacing:.08em;
      text-transform:uppercase;
      opacity:.9;
    }

    /* Chat card */
    .card{
      background:var(--panel);
      border-radius:22px;
      margin:14px;
      border:1px solid rgba(17,24,39,.10);
      overflow:hidden;
      display:flex;
      flex-direction:column;
     
    }

    /* Messages */
    .messages{
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:auto;
      flex:1;
      background:linear-gradient(180deg,#ffffff,#f7f8fb);
    }

    .bubble{
      max-width:100%;
      padding:10px 12px;
      border-radius:14px;
      line-height:1.45;
      font-size:13.5px;
      white-space:pre-wrap;
      word-break:break-word;
      border:1px solid rgba(17,24,39,.08);
    }
    .bot{
      align-self:flex-start;
      background:#fff;
    }
    .user{
      align-self:flex-end;
      background:#f2f1e9;
      border-bottom-right-radius:6px;
    }

    /* Suggested prompts */
    .suggestions{
      padding:10px 14px 0;
      background:#fff;
      border-top:1px solid rgba(17,24,39,.08);
    }
    .suggestions .label{
      font-size:11px;
      color:var(--muted);
      letter-spacing:.08em;
      text-transform:uppercase;
      margin-bottom:8px;
    }
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      padding-bottom:10px;
    }
    .chip{
      border:1px solid rgba(17,24,39,.12);
      background:#fff;
      color:#111827;
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      cursor:pointer;
      transition:transform .05s ease, background .1s ease;
    }
    .chip:hover{ background:#f3f4f6; transform:translateY(-1px); }
    .chip:active{ transform:translateY(0); }

    /* Composer */
    .composer{
      display:flex;
      gap:10px;
      padding:12px 14px 14px;
      background:#fff;
      border-top:1px solid rgba(17,24,39,.08);
      align-items:flex-end;
    }
    textarea{
      flex:1;
      min-height:46px;
      max-height:140px;
      resize:vertical;
      border-radius:14px;
      border:1px solid rgba(17,24,39,.15);
      padding:10px 12px;
      font-size:13.5px;
      line-height:1.35;
      outline:none;
    }
    textarea::placeholder{ color:#9ca3af; }

    button{
      border:none;
      border-radius:14px;
      padding:11px 14px;
      background:var(--accent);
      color:#fff;
      font-weight:600;
      cursor:pointer;
      transition:filter .1s ease, transform .05s ease;
      min-width:56px;
      height:46px;
    }
    button:hover{ filter:brightness(1.05); transform:translateY(-1px); }
    button:active{ transform:translateY(0); }
    button:disabled{ opacity:.55; cursor:default; transform:none; }

    /* Small footer status (optional) */
    .status{
      font-size:11px;
      color:var(--muted);
      padding:10px 14px 12px;
      background:#fff;
      border-top:1px solid rgba(17,24,39,.08);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 0 3px rgba(34,197,94,.18);
    }
    .dot.loading{
      background:#f59e0b;
      box-shadow:0 0 0 3px rgba(245,158,11,.18);
    }
  </style>
</head>

<body>
  <!--<div class="app">
    <div class="header">
      <div class="title">
        <h1>SAR Poetry Explorer</h1>
        <span>Mood &amp; theme based discovery</span>
      </div>
    </div>-->

    <div class="card">
      <div id="chat-log" class="messages">
        <div class="bubble bot">
Hi! I’m here to help you find poetry that matches your mood or what you're feeling.
You can tell me things like:
“I’m grieving a breakup and need something sympathetic but not maudlin.” or
“I feel anxious about my future. Give me something hopeful.”
        </div>
      </div>

      <!-- Suggested prompts as buttons -->
      <!--
      <div class="suggestions">
        <div class="label">Try a prompt</div>
        <div class="chips">
          <button class="chip" type="button" data-prompt="I’m going through a breakup and want something that acknowledges the pain but doesn’t sugarcoat it.">
            Breakup, no sugarcoating
          </button>
          <button class="chip" type="button" data-prompt="I feel anxious about my future and want something that gives me hope.">
            Anxious, need hope
          </button>
          <button class="chip" type="button" data-prompt="I’m burned out but still want to believe life has possibilities beyond today. Can you recommend something that sees both?">
            Burnout, still possible
          </button>
        </div>
      </div>-->

      <!-- Composer -->
      <div class="composer">
        <textarea id="user-input"></textarea>
        <button id="send-btn" title="Send">Send</button>
      </div>

  <div class="status">
        <div id="status-dot" class="dot"></div>
        <span id="status-text">Connected to SAR Poetry Explorer</span>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = "https://sar-poetry-explorer-api.onrender.com";
    let conversationId = null;

    const chatLog = document.getElementById("chat-log");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const statusText = document.getElementById("status-text");
    const statusDot = document.getElementById("status-dot");

    // Put your preferred “intro prompt” directly into the textbox on load
    const introDraft =
      "";
    userInput.value = introDraft;
    userInput.setSelectionRange(userInput.value.length, userInput.value.length);




 function addBubble(text, who) {
  const el = document.createElement("div");
  el.className = `bubble ${who === "user" ? "user" : "bot"}`;
  
  if (who === "bot") {
    // Convert URLs to clickable links for bot messages
    const linkedText = text.replace(
      /(https?:\/\/[^\s]+)/g,
      '<a href="$1" target="_blank" rel="noopener noreferrer" style="color: var(--accent); text-decoration: underline;">$1</a>'
    );
    el.innerHTML = linkedText;
  } else {
    el.textContent = text;
  }
  
  chatLog.appendChild(el);
  chatLog.scrollTop = chatLog.scrollHeight;
}








    async function sendMessage(textOverride = null) {
      const text = (textOverride ?? userInput.value).trim();

 if (!text) return;

      addBubble(text, "user");
      userInput.value = "";
      userInput.focus();

      sendBtn.disabled = true;
      statusDot.classList.add("loading");
      statusText.textContent = "Searching the SAR catalog…";

      try {
        const payload = { message: text, top_k: 3 };
        if (conversationId) payload.conversation_id = conversationId;

        const res = await fetch(`${API_BASE}/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const data = await res.json();
        conversationId = data.conversation_id || conversationId;

        // Bot reply (your backend already includes poem links in the reply copy)
        addBubble(data.reply || "[No reply]", "bot");

        statusText.textContent = "Connected to SAR Poetry Explorer";
      } catch (err) {
        console.error(err);
        addBubble(
          "Something went wrong reaching the explorer. Please try again in a moment.",
          "bot"
        );
        statusText.textContent = "Connection issue — check API URL / CORS";
      } finally {
        sendBtn.disabled = false;
        statusDot.classList.remove("loading");
      }
    }

    sendBtn.addEventListener("click", () => sendMessage());

    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Suggested prompt buttons
    document.querySelectorAll("[data-prompt]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const prompt = btn.getAttribute("data-prompt");
        // Put the suggested prompt into the textbox AND send immediately:
        userInput.value = prompt;
        userInput.focus();
        // If you'd rather NOT auto-send, comment out the next line
        sendMessage(prompt);
      });
    });
  </script>
</body>
</html>
